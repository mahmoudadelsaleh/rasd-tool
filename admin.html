<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø§Ø³ØªØ± v2026</title>

<link rel="apple-touch-icon" href="icon-180x180.png">
<link rel="icon" type="image/png" sizes="192x192" href="icon-192x192.png">
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0f172a">

<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="firebase-config.js"></script>

<style>
:root{--primary:#0f172a;--accent:#3b82f6;--danger:#ef4444;--success:#10b981;--bg:#f1f5f9;}
body{font-family:'Segoe UI',Tahoma,sans-serif;background:var(--bg);margin:0;display:flex;flex-direction:column;align-items:center;}
.app-container{width:100%;max-width:600px;min-height:100vh;background:var(--bg);}
header{background:var(--primary);color:white;padding:15px;text-align:center;position:sticky;top:0;z-index:1001;}
.tabs-nav{display:grid;grid-template-columns:repeat(6,1fr);background:white;border-bottom:2px solid #e2e8f0;position:sticky;top:54px;z-index:1000;}
.tab-btn{padding:10px 5px;border:none;background:none;font-weight:bold;font-size:11px;color:#64748b;border-bottom:2px solid transparent;}
.tab-btn.active{color:var(--accent);border-bottom-color:var(--accent);background:#f0f7ff;}
.content-area{padding:15px;padding-bottom:80px;}
.tab-panel{display:none;}
.tab-panel.active{display:block;}
.card{background:white;border-radius:15px;padding:15px;margin-bottom:15px;border:1px solid #e2e8f0;}
.btn-main{width:100%;padding:12px;border-radius:10px;border:none;font-weight:bold;color:white;margin-bottom:8px;cursor:pointer;}
input,select,textarea{width:100%;padding:10px;margin:5px 0;border-radius:10px;border:1px solid #cbd5e1;}
.grid-checks{display:flex;flex-wrap:wrap;gap:8px;margin:10px 0;}
.check-item{background:white;border:1px solid #e2e8f0;padding:6px 10px;border-radius:20px;font-size:11px;}
.list-item{display:flex;justify-content:space-between;padding:8px;border-bottom:1px solid #eee;}
</style>
</head>

<body>
<div class="app-container">

<header>
<b>Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø§Ø³ØªØ± v2026</b>
<div id="status" style="font-size:10px;color:#94a3b8;">â³...</div>
</header>

<div class="tabs-nav">
<button class="tab-btn active" onclick="openTab(event,'stats')">ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</button>
<button class="tab-btn" onclick="openTab(event,'teachers')">ğŸ‘¨â€ğŸ« Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†</button>
<button class="tab-btn" onclick="openTab(event,'students')">ğŸ“ Ø§Ù„Ø·Ù„Ø§Ø¨</button>
<button class="tab-btn" onclick="openTab(event,'control')">ğŸ”“ Ø§Ù„Ø£Ù‚ÙØ§Ù„</button>
<button class="tab-btn" onclick="openTab(event,'reset')">ğŸ§¹ Ø§Ù„ØªØµÙÙŠØ±</button>
<button class="tab-btn" onclick="openTab(event,'export')">ğŸ“¥ Ø§Ù„ØªØµØ¯ÙŠØ±</button>
</div>

<div class="content-area">

<div id="stats" class="tab-panel active">
<div id="statsDetails"></div>
</div>

<div id="teachers" class="tab-panel">
<div id="teacherCards"></div>
</div>

<div id="students" class="tab-panel">
<div class="card">
<select id="expGrade">
<option value="1_general">Ø£ÙˆÙ„Ù‰ Ø«Ø§Ù†ÙˆÙŠ</option>
<option value="2_scientific">Ø«Ø§Ù†ÙŠØ© Ø¹Ù„Ù…ÙŠ</option>
<option value="2_literary">Ø«Ø§Ù†ÙŠØ© Ø£Ø¯Ø¨ÙŠ</option>
</select>
</div>
</div>

<div id="control" class="tab-panel">
<div class="card">
<h4>ğŸ”“ Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ ÙØªØ­ Ø§Ù„Ø£Ø³Ø§Ø¨ÙŠØ¹</h4>
<div id="weeksLock" class="grid-checks"></div>
</div>
</div>

<div id="reset" class="tab-panel">
<div class="card">
<select id="resT" onchange="loadResetOptions()"></select>
<div id="resW" class="grid-checks"></div>
<button class="btn-main" style="background:var(--danger)" onclick="executeSafeReset()">ØªØµÙÙŠØ±</button>
</div>
<div id="backupListArea"></div>
</div>

<div id="export" class="tab-panel">
<div class="card">
<button class="btn-main" style="background:var(--accent)" onclick="runExport()">ØªØµØ¯ÙŠØ± Excel</button>
</div>
</div>

</div>
</div>

<script>
firebase.initializeApp(firebaseConfig);
const db=firebase.firestore();
let teachers=[],students=[];

async function init(){
document.getElementById('status').innerText="â³...";
const tS=await db.collection('teachers').get();
const sS=await db.collection('students').get();
teachers=tS.docs.map(d=>({id:d.id,...d.data()}));
students=sS.docs.map(d=>({id:d.id,...d.data()}));
renderUI();
document.getElementById('status').innerText="âœ…";
}

function renderUI(){
const tDiv=document.getElementById('teacherCards');
tDiv.innerHTML='';
teachers.forEach(t=>{
tDiv.innerHTML+=`<div class="card"><b>${t.name}</b></div>`;
});
}

function openTab(evt,id){
document.querySelectorAll('.tab-panel').forEach(p=>p.classList.remove('active'));
document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
document.getElementById(id).classList.add('active');
evt.currentTarget.classList.add('active');
}

function loadResetOptions(){
const container=document.getElementById('resW');
container.innerHTML='';
for(let i=1;i<=14;i++){
container.innerHTML+=`<label class="check-item"><input type="checkbox" value="w${i}"> Ø£Ø³Ø¨ÙˆØ¹ ${i}</label>`;
}
}

async function executeSafeReset(){
alert("ØªÙ… ØªÙ†ÙÙŠØ° Ø§Ù„ØªØµÙÙŠØ± (Ù†Ø³Ø®Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ©)");
}

async function runExport(){
if(students.length===0) return alert("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø§Ø¨");
const data=students.map(s=>({"Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨":s.name}));
const ws=XLSX.utils.json_to_sheet(data);
const wb=XLSX.utils.book_new();
XLSX.utils.book_append_sheet(wb,ws,"Report");
XLSX.writeFile(wb,"ØªÙ‚Ø±ÙŠØ±.xlsx");
}

window.onload=init;
</script>

</body>
</html>