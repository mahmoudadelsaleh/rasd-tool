<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø§Ø³ØªØ± v2026</title>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="firebase-config.js"></script>
    <style>
        :root { --primary: #0f172a; --accent: #3b82f6; --danger: #ef4444; --success: #10b981; --bg: #f1f5f9; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); margin: 0; display: flex; flex-direction: column; align-items: center; }
        .app-container { width: 100%; max-width: 600px; min-height: 100vh; background: var(--bg); box-shadow: 0 0 20px rgba(0,0,0,0.1); }
        header { background: var(--primary); color: white; padding: 15px; text-align: center; position: sticky; top: 0; z-index: 1001; display: flex; justify-content: center; align-items: center; gap: 10px; }
        .tabs-nav { display: grid; grid-template-columns: repeat(3, 1fr); background: white; border-bottom: 2px solid #e2e8f0; position: sticky; top: 54px; z-index: 1000; }
        .tab-btn { padding: 12px 5px; border: none; background: none; cursor: pointer; font-weight: bold; font-size: 11px; color: #64748b; border-bottom: 2px solid transparent; }
        .tab-btn.active { color: var(--accent); border-bottom-color: var(--accent); background: #f0f7ff; }
        .content-area { padding: 15px; padding-bottom: 80px; }
        .tab-panel { display: none; }
        .tab-panel.active { display: block; }
        .card { background: white; border-radius: 15px; padding: 15px; margin-bottom: 15px; border: 1px solid #e2e8f0; }
        .teacher-card { background: white; border-radius: 12px; padding: 15px; margin-bottom: 12px; border-right: 5px solid var(--accent); }
        .btn-main { width: 100%; padding: 12px; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; color: white; margin-bottom: 8px; }
        input, select, textarea { width: 100%; padding: 12px; margin: 5px 0 10px; border-radius: 10px; border: 1px solid #cbd5e1; background: #f8fafc; font-size: 14px; }
        .grid-checks { display: flex; flex-wrap: wrap; gap: 8px; margin: 10px 0; background: #f8fafc; padding: 10px; border-radius: 10px; }
        .check-item { background: white; border: 1px solid #e2e8f0; padding: 6px 12px; border-radius: 20px; font-size: 11px; display: flex; align-items: center; gap: 5px; }
    </style>
</head>
<body>
<div class="app-container">
    <header><b>Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø§Ø³ØªØ± v2026</b> <div id="status">...</div></header>
    <div class="tabs-nav">
        <button class="tab-btn active" onclick="openTab(event, 'stats')">ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</button>
        <button class="tab-btn" onclick="openTab(event, 'teachers')">ğŸ‘¨â€ğŸ« Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†</button>
        <button class="tab-btn" onclick="openTab(event, 'control')">ğŸ”“ Ø§Ù„Ø£Ù‚ÙØ§Ù„</button>
    </div>

    <div class="content-area">
        <div id="stats" class="tab-panel active">
            <div class="card">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†: <span id="s-t">0</span></div>
        </div>

        <div id="teachers" class="tab-panel">
            <div class="card">
                <h4>Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ù„Ù… Ø¬Ø¯ÙŠØ¯ (Auth)</h4>
                <input type="text" id="tName" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„">
                <input type="text" id="tSub" placeholder="Ø§Ù„Ù…Ø§Ø¯Ø©">
                <input type="text" id="tUser" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ø¨Ø¯ÙˆÙ† Ù…Ø³Ø§ÙØ§Øª)">
                <input type="text" id="tPass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± (6 Ø£Ø±Ù‚Ø§Ù… Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„)">
                <div class="grid-checks">
                    <label class="check-item"><input type="checkbox" name="tCls" value="1_general"> Ø£ÙˆÙ„Ù‰</label>
                    <label class="check-item"><input type="checkbox" name="tCls" value="2_scientific"> Ø¹Ù„Ù…ÙŠ</label>
                    <label class="check-item"><input type="checkbox" name="tCls" value="2_literary"> Ø£Ø¯Ø¨ÙŠ</label>
                </div>
                <button class="btn-main" style="background:var(--accent)" onclick="createNewTeacher()">Ø­ÙØ¸ ÙˆØªÙØ¹ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨</button>
            </div>
            <div id="teacherCards"></div>
        </div>

        <div id="control" class="tab-panel">
            <div class="card">
                <h4>ğŸ”“ Ø§Ù„Ø£Ø³Ø§Ø¨ÙŠØ¹ Ø§Ù„Ù…ÙØªÙˆØ­Ø©</h4>
                <div id="weeksLock" class="grid-checks"></div>
            </div>
        </div>
    </div>
</div>

<script>
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();
    let config = { openWeeks: [] };

    async function init() {
        auth.onAuthStateChanged(async (user) => {
            if (!user || sessionStorage.getItem('isAdmin') !== 'true') {
                location.href = "index.html";
                return;
            }
            loadData();
        });
    }

    async function loadData() {
        const tS = await db.collection('teachers').get();
        const cS = await db.collection('system').doc('config').get();
        if(cS.exists) config = cS.data();
        
        document.getElementById('s-t').innerText = tS.size;
        renderTeachers(tS);
        renderLocks();
    }

    async function createNewTeacher() {
        const u = document.getElementById('tUser').value.trim().toLowerCase();
        const p = document.getElementById('tPass').value.trim();
        const name = document.getElementById('tName').value;
        const sub = document.getElementById('tSub').value;
        const cls = Array.from(document.querySelectorAll('input[name="tCls"]:checked')).map(c => c.value);

        if(!u || p.length < 6) return alert("Ø§Ù„Ø§Ø³Ù… ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± (6 Ø®Ø§Ù†Ø§Øª) Ù…Ø·Ù„ÙˆØ¨ÙŠÙ†");

        try {
            // 1. Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ ÙÙŠ Authentication (ÙŠØ³ØªØ®Ø¯Ù… Ø¨Ø±ÙŠØ¯ ÙˆÙ‡Ù…ÙŠ)
            // Ù…Ù„Ø§Ø­Ø¸Ø©: Ù†Ø³ØªØ®Ø¯Ù… ØªØ·Ø¨ÙŠÙ‚ Ø«Ø§Ù†ÙˆÙŠ Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¯ÙˆÙ† ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ Ø§Ù„Ø£Ø¯Ù…Ù† Ø§Ù„Ø­Ø§Ù„ÙŠ
            const secondaryApp = firebase.initializeApp(firebaseConfig, "Secondary");
            await secondaryApp.auth().createUserWithEmailAndPassword(u + "@rasd.com", p);
            await secondaryApp.delete();

            // 2. Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Firestore
            await db.collection('teachers').doc(u).set({
                name, subject: sub, pass: p, classes: cls, role: "teacher"
            });

            alert("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¹Ù„Ù… Ø¨Ù†Ø¬Ø§Ø­");
            location.reload();
        } catch (e) {
            alert("Ø®Ø·Ø£: " + e.message);
        }
    }

    function renderTeachers(snap) {
        const div = document.getElementById('teacherCards');
        div.innerHTML = '';
        snap.forEach(doc => {
            const t = doc.data();
            div.innerHTML += `<div class="teacher-card"><b>${t.name}</b> (${t.subject}) <br> <small>ID: ${doc.id}</small></div>`;
        });
    }

    function renderLocks() {
        const lockG = document.getElementById('weeksLock');
        lockG.innerHTML = '';
        for(let i=1; i<=14; i++) {
            const w = 'w'+i;
            lockG.innerHTML += `<label class="check-item"><input type="checkbox" ${config.openWeeks.includes(w)?'checked':''} onchange="toggleW('${w}',this.checked)"> Ø£Ø³Ø¨ÙˆØ¹ ${i}</label>`;
        }
    }

    async function toggleW(w, s) {
        if(s) config.openWeeks.push(w);
        else config.openWeeks = config.openWeeks.filter(x => x !== w);
        await db.collection('system').doc('config').set(config);
    }

    function openTab(evt, tabId) {
        document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        evt.currentTarget.classList.add('active');
    }

    window.onload = init;
</script>
</body>
</html>
