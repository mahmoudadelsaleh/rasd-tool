<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>منظومة الرصد - تسجيل الدخول</title>

<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>

<style>
body{
font-family:Segoe UI;
background:#1e293b;
display:flex;
align-items:center;
justify-content:center;
height:100vh;
margin:0;
}
.card{
background:white;
padding:30px;
border-radius:20px;
width:90%;
max-width:380px;
text-align:center;
box-shadow:0 10px 30px rgba(0,0,0,.3);
}
input{
width:100%;
padding:12px;
margin:8px 0;
border-radius:10px;
border:1px solid #ddd;
}
button{
width:100%;
padding:12px;
border:none;
border-radius:10px;
background:#3b82f6;
color:white;
font-weight:bold;
cursor:pointer;
}
.error{
color:#ef4444;
font-size:13px;
margin-top:10px;
display:none;
}
</style>
</head>
<body>

<div class="card">
<h2>منظومة الرصد</h2>
<input type="text" id="user" placeholder="اسم المستخدم">
<input type="password" id="pass" placeholder="كلمة المرور">
<button id="loginBtn" onclick="handleLogin()">تسجيل الدخول</button>
<div id="err" class="error"></div>
</div>

<script>
const firebaseConfig={
apiKey:"AIzaSyBePGZiqMPmZQdg36jZ4Rkdtd7OISxmob8",
projectId:"rasd-tools"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.firestore();

if(sessionStorage.getItem("userEmail")){
if(sessionStorage.getItem("isAdmin")==="true"){
location.href="admin.html";
}else{
location.href="teacher.html";
}
}

async function handleLogin(){
const u=user.value.trim();
const p=pass.value.trim();
if(!u||!p)return;

loginBtn.disabled=true;
loginBtn.innerText="جاري التحقق...";
err.style.display="none";

if(u==="admin"&&p==="790707071"){
sessionStorage.setItem("userEmail","admin");
sessionStorage.setItem("isAdmin","true");
location.href="admin.html";
return;
}

try{
const doc=await db.collection("teachers").doc(u).get();
if(!doc.exists){
showError("اسم المستخدم غير موجود");
return;
}
if(doc.data().pass!==p){
showError("كلمة المرور غير صحيحة");
return;
}

sessionStorage.setItem("userEmail",u);
sessionStorage.removeItem("isAdmin");
location.href="teacher.html";

}catch(e){
showError("خطأ في الاتصال");
}
}

function showError(msg){
err.innerText=msg;
err.style.display="block";
loginBtn.disabled=false;
loginBtn.innerText="تسجيل الدخول";
}
</script>

</body>
</html>